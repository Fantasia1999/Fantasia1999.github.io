<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/favicon.ico">
  <link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=LatoEB Garamond:300,300italic,400,400italic,700,700italic|JetBrains Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://blog.zhuomu.xyz').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="转载自：NotOnlySuccess的博客很早前写的那篇线段树专辑至今一直是本博客阅读点击量最大的一片文章,当时觉得挺自豪的,还去pku打广告,但是现在我自己都不太好意思去看那篇文章了,觉得当时的代码风格实在是太丑了,很多线段树的初学者可能就是看着这篇文章来练习的,如果不小心被我培养出了这么糟糕的风格,实在是过意不去,正好过几天又要给集训队讲解线段树,所以决定把这些题目重新写一遍,顺便把近年我接触">
<meta property="og:type" content="article">
<meta property="og:title" content="【完全版】线段树">
<meta property="og:url" content="https://blog.zhuomu.xyz/2019/09/18/full-segment-tree/index.html">
<meta property="og:site_name" content="卓木&#39;s Blog">
<meta property="og:description" content="转载自：NotOnlySuccess的博客很早前写的那篇线段树专辑至今一直是本博客阅读点击量最大的一片文章,当时觉得挺自豪的,还去pku打广告,但是现在我自己都不太好意思去看那篇文章了,觉得当时的代码风格实在是太丑了,很多线段树的初学者可能就是看着这篇文章来练习的,如果不小心被我培养出了这么糟糕的风格,实在是过意不去,正好过几天又要给集训队讲解线段树,所以决定把这些题目重新写一遍,顺便把近年我接触">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-09-18T08:25:00.000Z">
<meta property="article:modified_time" content="2020-07-25T06:50:54.000Z">
<meta property="article:author" content="卓木">
<meta property="article:tag" content="算法竞赛">
<meta property="article:tag" content="线段树">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.zhuomu.xyz/2019/09/18/full-segment-tree/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
  <title>【完全版】线段树 | 卓木's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="卓木's Blog" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">卓木's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-desktop"></i>Home</a>

  </li>
        <li class="menu-item menu-item-kindle">

    <a href="/Kindle" rel="section"><i class="fa fa-fw fa-book"></i>Kindle</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user-circle-o"></i>About</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.zhuomu.xyz/2019/09/18/full-segment-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/medias/avatar.jpg">
      <meta itemprop="name" content="卓木">
      <meta itemprop="description" content="学习 分享 开源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="卓木's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【完全版】线段树
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-18 16:25:00" itemprop="dateCreated datePublished" datetime="2019-09-18T16:25:00+08:00">2019-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-07-25 14:50:54" itemprop="dateModified" datetime="2020-07-25T14:50:54+08:00">2020-07-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0%E6%9C%AC/" itemprop="url" rel="index">
                    <span itemprop="name">笔记本</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2019/09/18/full-segment-tree/#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/09/18/full-segment-tree/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><strong>转载自：NotOnlySuccess的博客</strong><br>很早前写的那篇线段树专辑至今一直是本博客阅读点击量最大的一片文章,当时觉得挺自豪的,还去pku打广告,但是现在我自己都不太好意思去看那篇文章了,觉得当时的代码风格实在是太丑了,很多线段树的初学者可能就是看着这篇文章来练习的,如果不小心被我培养出了这么糟糕的风格,实在是过意不去,正好过几天又要给集训队讲解线段树,所以决定把这些题目重新写一遍,顺便把近年我接触到的一些新题更新上去~;并且学习了splay等更高级的数据结构后对线段树的体会有更深了一层,线段树的写法也就比以前飘逸,简洁且方便多了.</p>
<span id="more"></span>

<p>在代码前先介绍一些我的线段树风格:</p>
<p>maxn是题目给的最大区间,而节点数要开4倍,确切的来说节点数要开大于maxn的最小2x的两倍</p>
<p>lson和rson分辨表示结点的左儿子和右儿子,由于每次传参数的时候都固定是这几个变量,所以可以用预定于比较方便的表示</p>
<p>以前的写法是另外开两个个数组记录每个结点所表示的区间,其实这个区间不必保存,一边算一边传下去就行,只需要写函数的时候多两个参数,结合lson和rson的预定义可以很方便</p>
<p>PushUP(int rt)是把当前结点的信息更新到父结点</p>
<p>PushDown(int rt)是把当前结点的信息更新给儿子结点</p>
<p>rt表示当前子树的根(root),也就是当前所在的结点</p>
<p>整理这些题目后我觉得线段树的题目整体上可以分成以下四个部分:</p>
<p>单点更新:最最基础的线段树,只更新叶子节点,然后把信息用PushUP(int r)这个函数更新上来</p>
<h1 id="区间查询"><a href="#区间查询" class="headerlink" title="区间查询"></a>区间查询</h1><h2 id="hdu1166-敌兵布阵"><a href="#hdu1166-敌兵布阵" class="headerlink" title="hdu1166 敌兵布阵"></a>hdu1166 敌兵布阵</h2><p>题意:O(-1)</p>
<p>思路:O(-1)</p>
<p>线段树功能:update:单点增减 query:区间求和</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">55555</span>;</span><br><span class="line"><span class="type">int</span> sum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUP</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;sum[rt]);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> add, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        sum[rt] += add;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= m) <span class="built_in">update</span>(p , add , lson);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(p , add , rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        <span class="keyword">return</span> sum[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) ret += <span class="built_in">query</span>(L , R , lson);</span><br><span class="line">    <span class="keyword">if</span> (R &gt; m) ret += <span class="built_in">query</span>(L , R , rson);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> T , n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> cas = <span class="number">1</span> ; cas &lt;= T ; cas ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d:\n&quot;</span>, cas);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        <span class="type">char</span> op[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;E&#x27;</span>) <span class="keyword">break</span>;</span><br><span class="line">            <span class="type">int</span> a , b;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(a , b , <span class="number">1</span> , n , <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">update</span>(a , -b , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">update</span>(a , b , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hdu1754-I-Hate-It"><a href="#hdu1754-I-Hate-It" class="headerlink" title="hdu1754 I Hate It"></a>hdu1754 I Hate It</h2><p>题意:O(-1)</p>
<p>思路:O(-1)</p>
<p>线段树功能:update:单点替换 query:区间最值</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">222222</span>;</span><br><span class="line"><span class="type">int</span> MAX[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUP</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    MAX[rt] = <span class="built_in">max</span>(MAX[rt &lt;&lt; <span class="number">1</span>] , MAX[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;MAX[rt]);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> sc, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        MAX[rt] = sc;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= m) <span class="built_in">update</span>(p , sc , lson);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(p , sc , rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        <span class="keyword">return</span> MAX[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) ret = <span class="built_in">max</span>(ret , <span class="built_in">query</span>(L , R , lson));</span><br><span class="line">    <span class="keyword">if</span> (R &gt; m) ret = <span class="built_in">max</span>(ret , <span class="built_in">query</span>(L , R , rson));</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n , m;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m)) &#123;</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (m --) &#123;</span><br><span class="line">            <span class="type">char</span> op[<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> a , b;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s%d%d&quot;</span>, op, &amp;a, &amp;b);</span><br><span class="line">            <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(a , b , <span class="number">1</span> , n , <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">update</span>(a , b , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hdu1394-Minimum-Inversion-Number"><a href="#hdu1394-Minimum-Inversion-Number" class="headerlink" title="hdu1394 Minimum Inversion Number"></a>hdu1394 Minimum Inversion Number</h2><p>题意:求Inversion后的最小逆序数</p>
<p>思路:用O(nlogn)复杂度求出最初逆序数后,就可以用O(1)的复杂度分别递推出其他解</p>
<p>线段树功能:update:单点增减 query:区间求和</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">5555</span>;</span><br><span class="line"><span class="type">int</span> sum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUP</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum[rt] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        sum[rt] ++;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (p &lt;= m) <span class="built_in">update</span>(p , lson);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">update</span>(p , rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        <span class="keyword">return</span> sum[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) ret += <span class="built_in">query</span>(L , R , lson);</span><br><span class="line">    <span class="keyword">if</span> (R &gt; m) ret += <span class="built_in">query</span>(L , R , rson);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> x[maxn];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) &#123;</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">0</span> , n - <span class="number">1</span> , <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x[i]);</span><br><span class="line">            sum += <span class="built_in">query</span>(x[i] , n - <span class="number">1</span> , <span class="number">0</span> , n - <span class="number">1</span> , <span class="number">1</span>);</span><br><span class="line">            <span class="built_in">update</span>(x[i] , <span class="number">0</span> , n - <span class="number">1</span> , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ret = sum;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line">            sum += n - x[i] - x[i] - <span class="number">1</span>;</span><br><span class="line">            ret = <span class="built_in">min</span>(ret , sum);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hdu2795-Billboard"><a href="#hdu2795-Billboard" class="headerlink" title="hdu2795 Billboard"></a>hdu2795 Billboard</h2><p>题意:h<em>w的木板,放进一些1</em>L的物品,求每次放空间能容纳且最上边的位子</p>
<p>思路:每次找到最大值的位子,然后减去L</p>
<p>线段树功能:query:区间求最大值的位子(直接把update的操作在query里做了)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">222222</span>;</span><br><span class="line"><span class="type">int</span> h , w , n;</span><br><span class="line"><span class="type">int</span> MAX[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUP</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    MAX[rt] = <span class="built_in">max</span>(MAX[rt &lt;&lt; <span class="number">1</span>] , MAX[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    MAX[rt] = w;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        MAX[rt] -= x;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ret = (MAX[rt &lt;&lt; <span class="number">1</span>] &gt;= x) ? <span class="built_in">query</span>(x , lson) : <span class="built_in">query</span>(x , rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;h, &amp;w, &amp;n)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (h &gt; n) h = n;</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span> , h , <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (n --) &#123;</span><br><span class="line">            <span class="type">int</span> x;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">            <span class="keyword">if</span> (MAX[<span class="number">1</span>] &lt; x) <span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(x , <span class="number">1</span> , h , <span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="练习"><a href="#练习" class="headerlink" title="练习:"></a>练习:</h2><p>poj2828 Buy Tickets</p>
<p>poj2886 Who Gets the Most Candies?</p>
<p>&#x2F;*************************************************************************************************************&#x2F;</p>
<h1 id="成段更新"><a href="#成段更新" class="headerlink" title="成段更新"></a>成段更新</h1><p>(通常这对初学者来说是一道坎),需要用到延迟标记(或者说懒惰标记),简单来说就是每次更新的时候不要更新到底,用延迟标记使得更新延迟到下次需要更新or询问到的时候</p>
<h2 id="hdu1698-Just-a-Hook"><a href="#hdu1698-Just-a-Hook" class="headerlink" title="hdu1698 Just a Hook"></a>hdu1698 Just a Hook</h2><p>题意:O(-1)</p>
<p>思路:O(-1)</p>
<p>线段树功能:update:成段替换 (由于只query一次总区间,所以可以直接输出1结点的信息)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">111111</span>;</span><br><span class="line"><span class="type">int</span> h , w , n;</span><br><span class="line"><span class="type">int</span> col[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> sum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUp</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (col[rt]) &#123;</span><br><span class="line">        col[rt &lt;&lt; <span class="number">1</span>] = col[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = col[rt];</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span>] = (m - (m &gt;&gt; <span class="number">1</span>)) * col[rt];</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = (m &gt;&gt; <span class="number">1</span>) * col[rt];</span><br><span class="line">        col[rt] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    col[rt] = <span class="number">0</span>;</span><br><span class="line">    sum[rt] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        col[rt] = c;</span><br><span class="line">        sum[rt] = c * (r - l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (R &gt; m) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> T , n , m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> cas = <span class="number">1</span> ; cas &lt;= T ; cas ++) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span> (m --) &#123;</span><br><span class="line">            <span class="type">int</span> a , b , c;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">            <span class="built_in">update</span>(a , b , c , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case %d: The total value of the hook is %d.\n&quot;</span>, cas , sum[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="poj3468-A-Simple-Problem-with-Integers"><a href="#poj3468-A-Simple-Problem-with-Integers" class="headerlink" title="poj3468 A Simple Problem with Integers"></a>poj3468 A Simple Problem with Integers</h2><p>题意:O(-1)</p>
<p>思路:O(-1)</p>
<p>线段树功能:update:成段增减 query:区间求和</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">111111</span>;</span><br><span class="line">LL add[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line">LL sum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUp</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (add[rt]) &#123;</span><br><span class="line">        add[rt &lt;&lt; <span class="number">1</span>] += add[rt];</span><br><span class="line">        add[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] += add[rt];</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span>] += add[rt] * (m - (m &gt;&gt; <span class="number">1</span>));</span><br><span class="line">        sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] += add[rt] * (m &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        add[rt] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    add[rt] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;sum[rt]);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        add[rt] += c;</span><br><span class="line">        sum[rt] += (LL)c * (r - l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">LL <span class="title">query</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        <span class="keyword">return</span> sum[rt];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    LL ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) ret += <span class="built_in">query</span>(L , R , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) ret += <span class="built_in">query</span>(L , R , rson);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> N , Q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;N, &amp;Q);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span> , N , <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (Q --) &#123;</span><br><span class="line">        <span class="type">char</span> op[<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> a , b , c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, op);</span><br><span class="line">        <span class="keyword">if</span> (op[<span class="number">0</span>] == <span class="string">&#x27;Q&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(a , b , <span class="number">1</span> , N , <span class="number">1</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">            <span class="built_in">update</span>(a , b , c , <span class="number">1</span> , N , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="poj2528-Mayor’s-posters"><a href="#poj2528-Mayor’s-posters" class="headerlink" title="poj2528 Mayor’s posters"></a>poj2528 Mayor’s posters</h2><p>题意:在墙上贴海报,海报可以互相覆盖,问最后可以看见几张海报</p>
<p>思路:这题数据范围很大,直接搞超时+超内存,需要离散化:</p>
<p>离散化简单的来说就是只取我们需要的值来用,比如说区间[1000,2000],[1990,2012] 我们用不到[-∞,999][1001,1989][1991,1999][2001,2011][2013,+∞]这些值,所以我只需要1000,1990,2000,2012就够了,将其分别映射到0,1,2,3,在于复杂度就大大的降下来了</p>
<p>所以离散化要保存所有需要用到的值,排序后,分别映射到1~n,这样复杂度就会小很多很多</p>
<p>而这题的难点在于每个数字其实表示的是一个单位长度(并且一个点),这样普通的离散化会造成许多错误(包括我以前的代码,poj这题数据奇弱)</p>
<p>给出下面两个简单的例子应该能体现普通离散化的缺陷:</p>
<p>1-10 1-4 5-10</p>
<p>1-10 1-4 6-10</p>
<p>为了解决这种缺陷,我们可以在排序后的数组上加些处理,比如说[1,2,6,10]</p>
<p>如果相邻数字间距大于1的话,在其中加上任意一个数字,比如加成[1,2,3,6,7,10],然后再做线段树就好了.</p>
<p>线段树功能:update:成段替换 query:简单hash</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">11111</span>;</span><br><span class="line"><span class="type">bool</span> hash[maxn];</span><br><span class="line"><span class="type">int</span> li[maxn] , ri[maxn];</span><br><span class="line"><span class="type">int</span> X[maxn * <span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> col[maxn &lt;&lt; <span class="number">4</span>];</span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (col[rt] != <span class="number">-1</span>) &#123;</span><br><span class="line">        col[rt &lt;&lt; <span class="number">1</span>] = col[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = col[rt];</span><br><span class="line">        col[rt] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        col[rt] = c;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (col[rt] != <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!hash[col[rt]]) cnt ++;</span><br><span class="line">        hash[ col[rt] ] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">query</span>(lson);</span><br><span class="line">    <span class="built_in">query</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Bin</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> n, <span class="type">int</span> X[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span> , r = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (X[m] == key) <span class="keyword">return</span> m;</span><br><span class="line">        <span class="keyword">if</span> (X[m] &lt; key) l = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = m - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> T , n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;T);</span><br><span class="line">    <span class="keyword">while</span> (T --) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">        <span class="type">int</span> nn = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;li[i] , &amp;ri[i]);</span><br><span class="line">            X[nn++] = li[i];</span><br><span class="line">            X[nn++] = ri[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(X , X + nn);</span><br><span class="line">        <span class="type">int</span> m = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span> ; i &lt; nn; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (X[i] != X[i - <span class="number">1</span>]) X[m ++] = X[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = m - <span class="number">1</span> ; i &gt; <span class="number">0</span> ; i --) &#123;</span><br><span class="line">            <span class="keyword">if</span> (X[i] != X[i - <span class="number">1</span>] + <span class="number">1</span>) X[m ++] = X[i] + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(X , X + m);</span><br><span class="line">        <span class="built_in">memset</span>(col , <span class="number">-1</span> , <span class="built_in">sizeof</span>(col));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">Bin</span>(li[i] , m , X);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">Bin</span>(ri[i] , m , X);</span><br><span class="line">            <span class="built_in">update</span>(l , r , i , <span class="number">0</span> , m , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(hash , <span class="literal">false</span> , <span class="built_in">sizeof</span>(hash));</span><br><span class="line">        <span class="built_in">query</span>(<span class="number">0</span> , m , <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, cnt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>poj3225 Help with Intervals</p>
<p>题意:区间操作,交,并,补等</p>
<p>思路:</p>
<p>我们一个一个操作来分析:(用0和1表示是否包含区间,-1表示该区间内既有包含又有不包含)</p>
<p>U:把区间[l,r]覆盖成1</p>
<p>I:把[-∞,l)(r,∞]覆盖成0</p>
<p>D:把区间[l,r]覆盖成0</p>
<p>C:把[-∞,l)(r,∞]覆盖成0 , 且[l,r]区间0&#x2F;1互换</p>
<p>S:[l,r]区间0&#x2F;1互换</p>
<p>成段覆盖的操作很简单,比较特殊的就是区间0&#x2F;1互换这个操作,我们可以称之为异或操作</p>
<p>很明显我们可以知道这个性质:当一个区间被覆盖后,不管之前有没有异或标记都没有意义了</p>
<p>所以当一个节点得到覆盖标记时把异或标记清空</p>
<p>而当一个节点得到异或标记的时候,先判断覆盖标记,如果是0或1,直接改变一下覆盖标记,不然的话改变异或标记</p>
<p>开区间闭区间只要数字乘以2就可以处理(偶数表示端点,奇数表示两端点间的区间)</p>
<p>线段树功能:update:成段替换,区间异或 query:简单hash</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">131072</span>;</span><br><span class="line"><span class="type">bool</span> hash[maxn];</span><br><span class="line"><span class="type">int</span> cover[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> XOR[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FXOR</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cover[rt] != <span class="number">-1</span>) cover[rt] ^= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> XOR[rt] ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cover[rt] != <span class="number">-1</span>) &#123;</span><br><span class="line">        cover[rt &lt;&lt; <span class="number">1</span>] = cover[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = cover[rt];</span><br><span class="line">        XOR[rt &lt;&lt; <span class="number">1</span>] = XOR[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        cover[rt] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (XOR[rt]) &#123;</span><br><span class="line">        <span class="built_in">FXOR</span>(rt &lt;&lt; <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">FXOR</span>(rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>);</span><br><span class="line">        XOR[rt] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">char</span> op, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="string">&#x27;U&#x27;</span>) &#123;</span><br><span class="line">            cover[rt] = <span class="number">1</span>;</span><br><span class="line">            XOR[rt] = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;D&#x27;</span>) &#123;</span><br><span class="line">            cover[rt] = <span class="number">0</span>;</span><br><span class="line">            XOR[rt] = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;C&#x27;</span> || op == <span class="string">&#x27;S&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">FXOR</span>(rt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(op , L , R , lson);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;I&#x27;</span> || op == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">        XOR[rt &lt;&lt; <span class="number">1</span>] = cover[rt &lt;&lt; <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(op , L , R , rson);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (op == <span class="string">&#x27;I&#x27;</span> || op == <span class="string">&#x27;C&#x27;</span>) &#123;</span><br><span class="line">        XOR[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = cover[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cover[rt] == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> it = l ; it &lt;= r ; it ++) &#123;</span><br><span class="line">            hash[it] = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cover[rt] == <span class="number">0</span>) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">query</span>(lson);</span><br><span class="line">    <span class="built_in">query</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cover[<span class="number">1</span>] = XOR[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> op , l , r;</span><br><span class="line">    <span class="type">int</span> a , b;</span><br><span class="line">    <span class="keyword">while</span> ( ~<span class="built_in">scanf</span>(<span class="string">&quot;%c %c%d,%d%c\n&quot;</span>, &amp;op , &amp;l , &amp;a , &amp;b , &amp;r) ) &#123;</span><br><span class="line">        a &lt;&lt;= <span class="number">1</span> , b &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (l == <span class="string">&#x27;(&#x27;</span>) a ++;</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="string">&#x27;)&#x27;</span>) b --;</span><br><span class="line">        <span class="keyword">if</span> (a &gt; b) &#123;</span><br><span class="line">            <span class="keyword">if</span> (op == <span class="string">&#x27;C&#x27;</span> || op == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">                cover[<span class="number">1</span>] = XOR[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="built_in">update</span>(op , a , b , <span class="number">0</span> , maxn , <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">query</span>(<span class="number">0</span> , maxn , <span class="number">1</span>);</span><br><span class="line">    <span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> s = <span class="number">-1</span> , e;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt;= maxn ; i ++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (hash[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s == <span class="number">-1</span>) s = i;</span><br><span class="line">            e = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (s != <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag) <span class="built_in">printf</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c%d,%d%c&quot;</span>, s &amp; <span class="number">1</span> ? <span class="string">&#x27;(&#x27;</span> : <span class="string">&#x27;[&#x27;</span> , s &gt;&gt; <span class="number">1</span> , (e + <span class="number">1</span>) &gt;&gt; <span class="number">1</span> , e &amp; <span class="number">1</span> ? <span class="string">&#x27;)&#x27;</span> : <span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">                s = <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) <span class="built_in">printf</span>(<span class="string">&quot;empty set&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="练习-1"><a href="#练习-1" class="headerlink" title="练习:"></a>练习:</h2><p>poj1436 Horizontally Visible Segments</p>
<p>poj2991 Crane</p>
<p>Another LCIS</p>
<p>Bracket Sequence</p>
<h1 id="区间合并"><a href="#区间合并" class="headerlink" title="区间合并"></a>区间合并</h1><p>这类题目会询问区间中满足条件的连续最长区间,所以PushUp的时候需要对左右儿子的区间进行合并</p>
<h2 id="poj3667-Hotel"><a href="#poj3667-Hotel" class="headerlink" title="poj3667 Hotel"></a>poj3667 Hotel</h2><p>题意:1 a:询问是不是有连续长度为a的空房间,有的话住进最左边</p>
<p>2 a b:将[a,a+b-1]的房间清空</p>
<p>思路:记录区间中最长的空房间</p>
<p>线段树操作:update:区间替换 query:询问满足条件的最左断点</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">55555</span>;</span><br><span class="line"><span class="type">int</span> lsum[maxn &lt;&lt; <span class="number">2</span>] , rsum[maxn &lt;&lt; <span class="number">2</span>] , msum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> cover[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushDown</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cover[rt] != <span class="number">-1</span>) &#123;</span><br><span class="line">        cover[rt &lt;&lt; <span class="number">1</span>] = cover[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = cover[rt];</span><br><span class="line">        msum[rt &lt;&lt; <span class="number">1</span>] = lsum[rt &lt;&lt; <span class="number">1</span>] = rsum[rt &lt;&lt; <span class="number">1</span>] = cover[rt] ? <span class="number">0</span> : m - (m &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        msum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = lsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = rsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] = cover[rt] ? <span class="number">0</span> : (m &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        cover[rt] = <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUp</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">    lsum[rt] = lsum[rt &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    rsum[rt] = rsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (lsum[rt] == m - (m &gt;&gt; <span class="number">1</span>)) lsum[rt] += lsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (rsum[rt] == (m &gt;&gt; <span class="number">1</span>)) rsum[rt] += rsum[rt &lt;&lt; <span class="number">1</span>];</span><br><span class="line">    msum[rt] = <span class="built_in">max</span>(lsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] + rsum[rt &lt;&lt; <span class="number">1</span>] , <span class="built_in">max</span>(msum[rt &lt;&lt; <span class="number">1</span>] , msum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    msum[rt] = lsum[rt] = rsum[rt] = r - l + <span class="number">1</span>;</span><br><span class="line">    cover[rt] = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        msum[rt] = lsum[rt] = rsum[rt] = c ? <span class="number">0</span> : r - l + <span class="number">1</span>;</span><br><span class="line">        cover[rt] = c;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> w, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) <span class="keyword">return</span> l;</span><br><span class="line">    <span class="built_in">PushDown</span>(rt , r - l + <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (msum[rt &lt;&lt; <span class="number">1</span>] &gt;= w) <span class="keyword">return</span> <span class="built_in">query</span>(w , lson);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (rsum[rt &lt;&lt; <span class="number">1</span>] + lsum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] &gt;= w) <span class="keyword">return</span> m - rsum[rt &lt;&lt; <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">query</span>(w , rson);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n , m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="built_in">build</span>(<span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (m --) &#123;</span><br><span class="line">        <span class="type">int</span> op , a , b;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;op);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a);</span><br><span class="line">            <span class="keyword">if</span> (msum[<span class="number">1</span>] &lt; a) <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> p = <span class="built_in">query</span>(a , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, p);</span><br><span class="line">                <span class="built_in">update</span>(p , p + a - <span class="number">1</span> , <span class="number">1</span> , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;a, &amp;b);</span><br><span class="line">            <span class="built_in">update</span>(a , a + b - <span class="number">1</span> , <span class="number">0</span> , <span class="number">1</span> , n , <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="练习-2"><a href="#练习-2" class="headerlink" title="练习:"></a>练习:</h2><p>hdu3308 LCIS</p>
<p>hdu3397 Sequence operation</p>
<p>hdu2871 Memory Control</p>
<p>hdu1540 Tunnel Warfare</p>
<p>CF46-D Parking Lot</p>
<h1 id="扫描线"><a href="#扫描线" class="headerlink" title="扫描线"></a>扫描线</h1><p>这类题目需要将一些操作排序,然后从左到右用一根扫描线(当然是在我们脑子里)扫过去</p>
<p>最典型的就是矩形面积并,周长并等题</p>
<h2 id="hdu1542-Atlantis"><a href="#hdu1542-Atlantis" class="headerlink" title="hdu1542 Atlantis"></a>hdu1542 Atlantis</h2><p>题意:矩形面积并</p>
<p>思路:浮点数先要离散化;然后把矩形分成两条边,上边和下边,对横轴建树,然后从下到上扫描上去,用cnt表示该区间下边比上边多几个</p>
<p>线段树操作:update:区间增减 query:直接取根节点的值</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">2222</span>;</span><br><span class="line"><span class="type">int</span> cnt[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">double</span> sum[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">double</span> X[maxn];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span> &#123;</span><br><span class="line">    <span class="type">double</span> h , l , r;</span><br><span class="line">    <span class="type">int</span> s;</span><br><span class="line">    <span class="built_in">Seg</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Seg</span>(<span class="type">double</span> a, <span class="type">double</span> b, <span class="type">double</span> c, <span class="type">int</span> d) : <span class="built_in">l</span>(a) , <span class="built_in">r</span>(b) , <span class="built_in">h</span>(c) , <span class="built_in">s</span>(d) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Seg &amp;cmp) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> h &lt; cmp.h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ss[maxn];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUp</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cnt[rt]) sum[rt] = X[r + <span class="number">1</span>] - X[l];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (l == r) sum[rt] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> sum[rt] = sum[rt &lt;&lt; <span class="number">1</span>] + sum[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        cnt[rt] += c;</span><br><span class="line">        <span class="built_in">PushUp</span>(rt , l , r);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">    <span class="built_in">PushUp</span>(rt , l , r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Bin</span><span class="params">(<span class="type">double</span> key, <span class="type">int</span> n, <span class="type">double</span> X[])</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span> , r = n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (X[m] == key) <span class="keyword">return</span> m;</span><br><span class="line">        <span class="keyword">if</span> (X[m] &lt; key) l = m + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r = m - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n , cas = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) &amp;&amp; n) &#123;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (n --) &#123;</span><br><span class="line">            <span class="type">double</span> a , b , c , d;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%lf%lf%lf%lf&quot;</span>, &amp;a, &amp;b, &amp;c, &amp;d);</span><br><span class="line">            X[m] = a;</span><br><span class="line">            ss[m++] = <span class="built_in">Seg</span>(a , c , b , <span class="number">1</span>);</span><br><span class="line">            X[m] = c;</span><br><span class="line">            ss[m++] = <span class="built_in">Seg</span>(a , c , d , <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(X , X + m);</span><br><span class="line">        <span class="built_in">sort</span>(ss , ss + m);</span><br><span class="line">        <span class="type">int</span> k = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span> ; i &lt; m ; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (X[i] != X[i - <span class="number">1</span>]) X[k++] = X[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(cnt , <span class="number">0</span> , <span class="built_in">sizeof</span>(cnt));</span><br><span class="line">        <span class="built_in">memset</span>(sum , <span class="number">0</span> , <span class="built_in">sizeof</span>(sum));</span><br><span class="line">        <span class="type">double</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; m - <span class="number">1</span> ; i ++) &#123;</span><br><span class="line">            <span class="type">int</span> l = <span class="built_in">Bin</span>(ss[i].l , k , X);</span><br><span class="line">            <span class="type">int</span> r = <span class="built_in">Bin</span>(ss[i].r , k , X) - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l &lt;= r) <span class="built_in">update</span>(l , r , ss[i].s , <span class="number">0</span> , k - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">            ret += sum[<span class="number">1</span>] * (ss[i + <span class="number">1</span>].h - ss[i].h);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Test case #%d\nTotal explored area: %.2lf\n\n&quot;</span>, cas++ , ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hdu1828-Picture"><a href="#hdu1828-Picture" class="headerlink" title="hdu1828 Picture"></a>hdu1828 Picture</h2><p>题意:矩形周长并</p>
<p>思路:与面积不同的地方是还要记录竖的边有几个(numseg记录),并且当边界重合的时候需要合并(用lbd和rbd表示边界来辅助)</p>
<p>线段树操作:update:区间增减 query:直接取根节点的值</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson l , m , rt &lt;&lt; 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson m + 1 , r , rt &lt;&lt; 1 | 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">22222</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Seg</span> &#123;</span><br><span class="line">    <span class="type">int</span> l , r , h , s;</span><br><span class="line">    <span class="built_in">Seg</span>() &#123;&#125;</span><br><span class="line">    <span class="built_in">Seg</span>(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, <span class="type">int</span> d): <span class="built_in">l</span>(a) , <span class="built_in">r</span>(b) , <span class="built_in">h</span>(c) , <span class="built_in">s</span>(d) &#123;&#125;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Seg &amp;cmp) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> h &lt; cmp.h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ss[maxn];</span><br><span class="line"><span class="type">bool</span> lbd[maxn &lt;&lt; <span class="number">2</span>] , rbd[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> numseg[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> cnt[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> len[maxn &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PushUP</span><span class="params">(<span class="type">int</span> rt, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cnt[rt]) &#123;</span><br><span class="line">        lbd[rt] = rbd[rt] = <span class="number">1</span>;</span><br><span class="line">        len[rt] = r - l + <span class="number">1</span>;</span><br><span class="line">        numseg[rt] = <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">        len[rt] = numseg[rt] = lbd[rt] = rbd[rt] = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lbd[rt] = lbd[rt &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        rbd[rt] = rbd[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">        len[rt] = len[rt &lt;&lt; <span class="number">1</span>] + len[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">        numseg[rt] = numseg[rt &lt;&lt; <span class="number">1</span>] + numseg[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (lbd[rt &lt;&lt; <span class="number">1</span> | <span class="number">1</span>] &amp;&amp; rbd[rt &lt;&lt; <span class="number">1</span>]) numseg[rt] -= <span class="number">2</span>; <span class="comment">//两条线重合</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> c, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> rt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">        cnt[rt] += c;</span><br><span class="line">        <span class="built_in">PushUP</span>(rt , l , r);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (L &lt;= m) <span class="built_in">update</span>(L , R , c , lson);</span><br><span class="line">    <span class="keyword">if</span> (m &lt; R) <span class="built_in">update</span>(L , R , c , rson);</span><br><span class="line">    <span class="built_in">PushUP</span>(rt , l , r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n)) &#123;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> lbd = <span class="number">10000</span>, rbd = <span class="number">-10000</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line">            <span class="type">int</span> a , b , c , d;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;a, &amp;b, &amp;c, &amp;d);</span><br><span class="line">            lbd = <span class="built_in">min</span>(lbd , a);</span><br><span class="line">            rbd = <span class="built_in">max</span>(rbd , c);</span><br><span class="line">            ss[m++] = <span class="built_in">Seg</span>(a , c , b , <span class="number">1</span>);</span><br><span class="line">            ss[m++] = <span class="built_in">Seg</span>(a , c , d , <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(ss , ss + m);</span><br><span class="line">        <span class="type">int</span> ret = <span class="number">0</span> , last = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span> ; i &lt; m ; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ss[i].l &lt; ss[i].r) <span class="built_in">update</span>(ss[i].l , ss[i].r - <span class="number">1</span> , ss[i].s , lbd , rbd - <span class="number">1</span> , <span class="number">1</span>);</span><br><span class="line">            ret += numseg[<span class="number">1</span>] * (ss[i + <span class="number">1</span>].h - ss[i].h);</span><br><span class="line">            ret += <span class="built_in">abs</span>(len[<span class="number">1</span>] - last);</span><br><span class="line">            last = len[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h2><p>hdu3265 Posters</p>
<p>hdu3642 Get The Treasury</p>
<p>poj2482 Stars in Your Window</p>
<p>poj2464 Brownie Points II</p>
<p>hdu3255 Farming</p>
<p>ural1707 Hypnotoad’s Secret</p>
<p>uva11983 Weird Advertisement</p>
<h1 id="线段树与其他结合练习-欢迎大家补充"><a href="#线段树与其他结合练习-欢迎大家补充" class="headerlink" title="线段树与其他结合练习(欢迎大家补充):"></a>线段树与其他结合练习(欢迎大家补充):</h1><p>hdu3333 Turing Tree</p>
<p>hdu3874 Necklace</p>
<p>hdu3016 Man Down</p>
<p>hdu3340 Rain in ACStar</p>
<p>zju3511 Cake Robbery</p>
<p>UESTC1558 Charitable Exchange</p>
<p>CF85-D Sum of Medians</p>
<p>spojGSS2 Can you answer these queries II</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/" rel="tag"># 算法竞赛</a>
              <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag"># 线段树</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/03/08/FPGA-Quartus-Prime-17_0-install-crack/" rel="prev" title="FPGA Quartus Prime 17.0 安装破解">
      <i class="fa fa-chevron-left"></i> FPGA Quartus Prime 17.0 安装破解
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/10/15/c-operator_precedence/" rel="next" title="C语言运算符优先级">
      C语言运算符优先级 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2"><span class="nav-number">1.</span> <span class="nav-text">区间查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1166-%E6%95%8C%E5%85%B5%E5%B8%83%E9%98%B5"><span class="nav-number">1.1.</span> <span class="nav-text">hdu1166 敌兵布阵</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1754-I-Hate-It"><span class="nav-number">1.2.</span> <span class="nav-text">hdu1754 I Hate It</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1394-Minimum-Inversion-Number"><span class="nav-number">1.3.</span> <span class="nav-text">hdu1394 Minimum Inversion Number</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu2795-Billboard"><span class="nav-number">1.4.</span> <span class="nav-text">hdu2795 Billboard</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0"><span class="nav-number">1.5.</span> <span class="nav-text">练习:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%88%90%E6%AE%B5%E6%9B%B4%E6%96%B0"><span class="nav-number">2.</span> <span class="nav-text">成段更新</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1698-Just-a-Hook"><span class="nav-number">2.1.</span> <span class="nav-text">hdu1698 Just a Hook</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#poj3468-A-Simple-Problem-with-Integers"><span class="nav-number">2.2.</span> <span class="nav-text">poj3468 A Simple Problem with Integers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#poj2528-Mayor%E2%80%99s-posters"><span class="nav-number">2.3.</span> <span class="nav-text">poj2528 Mayor’s posters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="nav-number">2.4.</span> <span class="nav-text">练习:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6"><span class="nav-number">3.</span> <span class="nav-text">区间合并</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#poj3667-Hotel"><span class="nav-number">3.1.</span> <span class="nav-text">poj3667 Hotel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-2"><span class="nav-number">3.2.</span> <span class="nav-text">练习:</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E7%BA%BF"><span class="nav-number">4.</span> <span class="nav-text">扫描线</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1542-Atlantis"><span class="nav-number">4.1.</span> <span class="nav-text">hdu1542 Atlantis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hdu1828-Picture"><span class="nav-number">4.2.</span> <span class="nav-text">hdu1828 Picture</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%83%E4%B9%A0-3"><span class="nav-number">4.3.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%8E%E5%85%B6%E4%BB%96%E7%BB%93%E5%90%88%E7%BB%83%E4%B9%A0-%E6%AC%A2%E8%BF%8E%E5%A4%A7%E5%AE%B6%E8%A1%A5%E5%85%85"><span class="nav-number">5.</span> <span class="nav-text">线段树与其他结合练习(欢迎大家补充):</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="卓木"
      src="https://cdn.jsdelivr.net/gh/Fantasia1999/Fantasia1999.github.io/medias/avatar.jpg">
  <p class="site-author-name" itemprop="name">卓木</p>
  <div class="site-description" itemprop="description">学习 分享 开源</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">93</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Fantasia1999" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Fantasia1999" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:i@zhuomu.xyz" title="E-Mail → mailto:i@zhuomu.xyz" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/Kindle" title="Kindle → &#x2F;Kindle"><i class="fa fa-fw fa-book"></i>Kindle</a>
      </span>
      <span class="links-of-author-item">
        <a href="/rss2.xml" title="RSS → &#x2F;rss2.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">卓木</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://blog-zhuomu.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://blog.zhuomu.xyz/2019/09/18/full-segment-tree/",
            identifier: "2019/09/18/full-segment-tree/",
            title: "【完全版】线段树"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://blog-zhuomu.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
